<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.leanshi.mapper.RdReceivableDetailMapper">

    <resultMap id="RDResultMap" type="cn.leanshi.model.RdReceivableDetail">
        <result column="TRANS_NUMBER" property="transNumber" />
        <result column="BATCH_NUMBER" property="batchNumber" />
        <result column="MM_CODE" property="mCode" />
        <result column="MM_NICK_NAME" property="mNickname" />
        <result column="TR_TYPE_CODE" property="trTypeCode" />
        <result column="TR_SOURCE_TYPE" property="trSourceType" />
        <result column="TR_BANK_OID" property="trBankOid" />
        <result column="CURRENCY_CODE" property="currencyCode" />
        <result column="BLANCE_BEFORE" property="blanceBefore" />
        <result column="AMOUNT" property="amount" />
        <result column="BLANCE_AFTER" property="blanceAfter" />
        <result column="BNS_DEDUCT_PECENT" property="bnsDeductPecent" />
        <result column="TRANS_DATE" property="transDate" />
        <result column="TRANS_PERIOD" property="transPeriod" />
        <result column="TRANS_DESC" property="transDesc" />
        <result column="STATUS" property="status" />
        <result column="WASHED_YN" property="washedYn" />
        <result column="ORIGN_TRANS_NUMBER" property="orignTransNumber" />
        <result column="CREATION_BY" property="creationBy" />
        <result column="CREATION_TIME" property="creationTime" />
        <result column="UPDATE_BY" property="updateBy" />
        <result column="UPDATE_TIME" property="updateTime" />
        <result column="AUTOHRIZE_BY" property="autohrizeBy" />
        <result column="AUTOHRIZE_TIME" property="autohrizeTime" />
        <result column="AUTOHRIZE_DESC" property="autohrizeDesc" />
    </resultMap>
<<<<<<< HEAD
    <select id="findRdReceivableDetailLast" parameterType="string" resultMap="RDResultMap">
        select * from rd_receiveable_detail where MM_CODE = #{mCode} and STATUS = 3 order by CREATION_TIME desc limit 0,1
    </select>

    <insert id="insertRdReceivableDetail" parameterType="cn.leanshi.model.RdReceivableDetail">
        insert into rd_receiveable_detail (TRANS_NUMBER,BATCH_NUMBER,MM_CODE,TR_TYPE_CODE,
        TR_SOURCE_TYPE,CURRENCY_CODE,BLANCE_BEFORE,AMOUNT, BLANCE_AFTER,TRANS_PERIOD,STATUS,CREATION_TIME) values
        (#{transNumber},#{batchNumber},#{mCode},#{trTypeCode},#{trSourceType},#{currencyCode},
        #{blanceBefore},#{amount},#{blanceAfter},#{transPeriod},#{status},#{creationTime})
    </insert>
=======

    <!--创建欠款明细表-->
    <insert id="addRDNR" parameterType="cn.leanshi.model.RdReceivableDetail">
        INSERT INTO rd_receiveable_detail(TRANS_NUMBER,MM_CODE,MM_NICK_NAME,TR_TYPE_CODE,TR_SOURCE_TYPE,TR_BANK_OID,
        CURRENCY_CODE,BLANCE_BEFORE,AMOUNT,BLANCE_AFTER,BNS_DEDUCT_PECENT,
        TRANS_DATE,STATUS,CREATION_BY,UPDATE_TIME)
        VALUES (#{transNumber},#{mCode},#{mNickname},#{trTypeCode},#{trSourceType},#{trBankOid},#{currencyCode},
        #{blanceBefore},#{amount},#{blanceAfter},#{bnsDeductPecent},#{transDate},#{status},
        #{creationBy},#{creationTime})
    </insert>

    <!--创建还款明细表-->
    <insert id="addRDRR" parameterType="cn.leanshi.model.RdReceivableDetail">
        INSERT INTO rd_receiveable_detail(TRANS_NUMBER,MM_CODE,MM_NICK_NAME,TR_TYPE_CODE,TR_SOURCE_TYPE,TR_BANK_OID,
        CURRENCY_CODE,BLANCE_BEFORE,AMOUNT,BLANCE_AFTER,BNS_DEDUCT_PECENT,
        TRANS_DATE,STATUS,CREATION_BY,UPDATE_TIME)
        VALUES (#{transNumber},#{mCode},#{mNickname},#{trTypeCode},#{trSourceType},#{currencyCode},
        #{blanceBefore},#{amount},#{blanceAfter}#{transDate},#{status},
        #{creationBy},#{creationTime})
    </insert>


    <!--添加模糊搜索-->
    <select id="findReceivableDetailAll" parameterType="java.util.Map" resultMap="RDResultMap">
        SELECT * FROM rd_receiveable_detail
        WHERE 1=1
        <if test="transNumber !=null">
            AND TRANS_NUMBER = #{transNumber}
        </if>
        <if test="mCode !=null and mCode != ''">
            AND MM_CODE LIKE "%"#{mCode}"%"
        </if>
        <if test="mNickname !=null and mNickname != ''">
            AND MM_NICK_NAME LIKE "%"#{mNickname}"%"
        </if>
        <if test="trTypeCode !=null and trTypeCode != ''">
            AND TR_TYPE_CODE = #{trTypeCode}
        </if>
        <if test="status !=0">
            AND STATUS = #{status}
        </if>
        <if test="timeStar !=null and timeEnd !=null">
            AND TRANS_DATE BETWEEN #{timeStar} AND #{timeEnd}
        </if>
        ORDER BY TRANS_DATE ASC
    </select>

    <!--审核会员-->
    <update id="updateRD" parameterType="java.util.Map">
        UPDATE rd_receiveable_detail
        SET
        STATUS = #{status}
        WHERE MM_CODE = #{mCode}
    </update>

    <!--根据编号和流水号查欠款明细-->
    <select id="findRD" parameterType="java.util.Map" resultMap="RDResultMap">
        SELECT * FROM rd_receiveable_detail WHERE MM_CODE = #{mCode} AND TRANS_NUMBER = #{transNumber}
    </select>


>>>>>>> a5e07af72178f8c9f206d2a74eec3d9172b3c8eb
</mapper>